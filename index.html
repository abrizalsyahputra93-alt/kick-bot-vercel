<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kick Bot Padang</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #1e3c72; color: white; display:flex; justify-content:center; align-items:center; height:100vh; }
  .card { background: rgba(255,255,255,0.1); padding: 30px; border-radius:20px; backdrop-filter: blur(10px); }
  input, button { width:100%; margin:8px 0; padding:12px; border-radius:10px; border:none; font-size:16px; }
  button { background:#00d26a; font-weight:bold; color:white; cursor:pointer; }
  button:hover { background:#00b359; }
  .status { margin-top:10px; font-size:14px; }
</style>
</head>
<body>
<div class="card">
  <h1>Kick Bot Padang</h1>
  <div id="login">
    <button onclick="login()">Login dengan Kick</button>
  </div>

  <div id="bot" style="display:none;">
    <input type="text" id="channel" placeholder="Nama channel">
    <input type="text" id="message" placeholder="Pesan yang dikirim">
    <button onclick="sendMessage()">Kirim Pesan</button>
    <div class="status" id="status"></div>
  </div>
</div>

<script>
const CLIENT_ID = '01K9SEDGKEAB4KH7WAJ8Q2XGVD';
const REDIRECT_URI = 'https://kick-bot-vercel.vercel.app/api/auth';
let token = null;

function login() {
  const params = new URLSearchParams({
    client_id: CLIENT_ID,
    redirect_uri: REDIRECT_URI,
    response_type: 'code',
    scope: 'chat:read chat:write',
    state: 'kick-bot-padang'
  });
  window.location.href = `https://kick.com/oauth/authorize?${params.toString()}`;
}

// Ambil token dari query string
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('token')) {
  token = urlParams.get('token');
  document.getElementById('login').style.display = 'none';
  document.getElementById('bot').style.display = 'block';
  document.getElementById('status').innerText = 'Login sukses!';
}

async function sendMessage() {
  const channel = document.getElementById('channel').value;
  const message = document.getElementById('message').value;
  if (!token) return alert('Login dulu!');
  if (!channel || !message) return alert('Isi channel dan message!');

  const res = await fetch('/api/bot', {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify({ token, channel, message })
  });
  const data = await res.json();
  document.getElementById('status').innerText = data.success ? 'Pesan terkirim!' : 'Gagal kirim';
}
</script>
</body>
</html>
